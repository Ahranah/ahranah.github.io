---
layout: post
title: "[Oracle] 오라클 시간 처리 문법 정리"
date: 2025-12-17 00:48:24 +0900
categories: [Algorithm, 프로그래머스]
tags: [oracle, connect_by, database]
---

[입양 시각 구하기(2) Lv 4](https://school.programmers.co.kr/learn/courses/30/lessons/59413?language=oracle)

[프로그래머스SW개발자를 위한 평가, 교육의 Total Solution을 제공하는 개발자 성장을 위한 베이스캠프programmers.co.kr](https://school.programmers.co.kr/learn/courses/30/lessons/59413?language=oracle)
 

- DB에 없는 값을 시간은 만들어서 반환해야 함 -> Recursive CTE or CONNECT BY LEVEL
- 시간 추출: mysql은 hour()로 할 수 있지만 오라클은 형 명시해줘야함

{% include figure.liquid loading="eager" path="assets/img/posts/2025-12-17-oracle-오라클-시간-처리-문법-정리/img.png" class="img-fluid rounded z-depth-1" %}

Mysql 버전

```sql
WITH RECURSIVE TIME_MAP AS (
    SELECT 0 AS hour
    UNION ALL
    SELECT hour + 1 FROM TIME_MAP WHERE hour < 23
)

SELECT 
    t.hour,                -- 기준 테이블(t)의 시간을 선택
    COUNT(a.animal_id)     -- ID가 없으면 0으로 세야 하므로 COUNT(*) 대신 컬럼 명시
FROM TIME_MAP t            -- 시간 테이블이 '왼쪽'이어야 함
LEFT JOIN ANIMAL_OUTS a 
    ON t.hour = HOUR(a.datetime)
GROUP BY t.hour            -- 기준 테이블(t) 기준으로 그룹핑
ORDER BY t.hour;
```

 

오라클 버전

- recursive CTE -> Connect by level 라는 계층형 쿼리로 변환해서 사용한다.Connect by는 ~ 조건이 될 때까지처럼 사용 가능, 내부적으로 level (무조건 1부터 시작)을 만들어서 카운트하기 때문에 이를 recursive 대신 사용한다.근데 이 때 from이 없으면 에러나기 때문에 내부에서 지원하는 dual(dummy table)을 써준다.
- 오라클도 CTE 지원한다.

```sql
-- 코드를 입력하세요
SELECT t.hour, count(a.animal_id) as count
from (
    select level-1 as hour -- level은 1부터 시작
    from dual
    connect by level <= 24
) t
left join animal_outs a 
on t.hour = to_number(to_char(a.datetime, 'HH24'))
group by t.hour
order by t.hour
```

 

[상품을 구매한 직원 회원 비율 구하기](https://school.programmers.co.kr/learn/courses/30/lessons/131534)

[프로그래머스SW개발자를 위한 평가, 교육의 Total Solution을 제공하는 개발자 성장을 위한 베이스캠프programmers.co.kr](https://school.programmers.co.kr/learn/courses/30/lessons/131534)
 

21년에 가입한 사람과, 21년에 가입한 사람 중 물건을 산 사람의 비율을 소수점 두번째자리에서 반올림해서 반환해야 한다.

- 가입한 사람의 전체 인원 수는, 메인에서 Where로 조건 걸면 join 물건 산 사람할때 전체 인원 수가 날라가고, 구매한 사람 수만 남기 때문에 전체 인원수는 서브쿼리로 독립적으로 숫자를 세줘야 한다.

오라클 준비물

분류
코드
설명
예시 (2025-12-05 14:05:09)

연도
YYYY
4자리 연도
2025

 
YY
2자리 연도
25

월
MM
2자리 월 (숫자)
12

 
MON
월 이름 (약어)
DEC (영문판), 12월 (한글판)

일
DD
2자리 일
05

요일
DY
요일 약어
THU, 목

 
DAY
요일 전체
THURSDAY, 목요일

시간
HH24
24시간제 (0-23)
14 

 
HH
12시간제 (1-12)
02

분
MI
분 (Minute)
05 (MM 아님! 주의)

초
SS
초 (Second)
09

- MM을 char로 뽑으면 03, 05이렇게 0이 붙어나와서 to_number 필요

```sql
SELECT TO_CHAR(SYSDATE, 'YYYY-MM-DD HH24:MI:SS') FROM DUAL;
-- 결과: 2025-12-05 14:05:09

SELECT 
    to_char(o.sales_date, 'YYYY') as year,
    to_number(to_char(o.sales_date, 'MM')) as month,
    count(distinct o.user_id) as purchased_users,
    round(count(distinct o.user_id) / 
          (select count(*) from user_info where to_char(joined, 'YYYY') = '2021'), 1) as purchased_ratio
from user_info a
join online_sale o on a.user_id = o.user_id 
where to_char(a.joined, 'YYYY') = '2021'
group by to_char(o.sales_date, 'YYYY'), to_char(o.sales_date, 'MM')
order by year, month
```